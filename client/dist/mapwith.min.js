var require=function(e,n){var t=require.resolve(e,n||"/"),o=require.modules[t];if(!o)throw Error("Failed to resolve module "+e+", tried "+t);var r=require.cache[t],a=r?r.exports:o();return a};require.paths=[],require.modules={},require.cache={},require.extensions=[".js",".coffee",".json"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(e,n){function t(e){if(e=i.normalize(e),require.modules[e])return e;for(var n=0;require.extensions.length>n;n++){var t=require.extensions[n];if(require.modules[e+t])return e+t}}function o(e){e=e.replace(/\/+$/,"");var n=i.normalize(e+"/package.json");if(require.modules[n]){var o=require.modules[n](),r=o.browserify;if("object"==typeof r&&r.main){var a=t(i.resolve(e,r.main));if(a)return a}else if("string"==typeof r){var a=t(i.resolve(e,r));if(a)return a}else if(o.main){var a=t(i.resolve(e,o.main));if(a)return a}}return t(e+"/index")}function r(e,n){for(var r=a(n),i=0;r.length>i;i++){var s=r[i],p=t(s+"/"+e);if(p)return p;var c=o(s+"/"+e);if(c)return c}var p=t(e);return p?p:void 0}function a(e){var n;n="/"===e?[""]:i.normalize(e).split("/");for(var t=[],o=n.length-1;o>=0;o--)if("node_modules"!==n[o]){var r=n.slice(0,o+1).join("/")+"/node_modules";t.push(r)}return t}if(n||(n="/"),require._core[e])return e;var i=require.modules.path();n=i.resolve("/",n);var s=n||"/";if(e.match(/^(?:\.\.?\/|\/)/)){var p=t(i.resolve(s,e))||o(i.resolve(s,e));if(p)return p}var c=r(e,s);if(c)return c;throw Error("Cannot find module '"+e+"'")}}(),require.alias=function(e,n){var t=require.modules.path(),o=null;try{o=require.resolve(e+"/package.json","/")}catch(r){o=require.resolve(e,"/")}for(var a=t.dirname(o),i=(Object.keys||function(e){var n=[];for(var t in e)n.push(t);return n})(require.modules),s=0;i.length>s;s++){var p=i[s];if(p.slice(0,a.length+1)===a+"/"){var c=p.slice(a.length);require.modules[n+c]=require.modules[a+c]}else p===a&&(require.modules[n]=require.modules[a])}},function(){var e={},n="undefined"!=typeof window?window:{},t=!1;require.define=function(o,r){!t&&require.modules.__browserify_process&&(e=require.modules.__browserify_process(),t=!0);var a=require._core[o]?"":require.modules.path().dirname(o),i=function(e){var n=require(e,a),t=require.cache[require.resolve(e,a)];return t&&null===t.parent&&(t.parent=s),n};i.resolve=function(e){return require.resolve(e,a)},i.modules=require.modules,i.define=require.define,i.cache=require.cache;var s={id:o,filename:o,exports:{},loaded:!1,parent:null};require.modules[o]=function(){return require.cache[o]=s,r.call(s.exports,i,s,s.exports,a,o,e,n),s.loaded=!0,s.exports}}}(),require.define("path",function(e,n,t,o,r,a){function i(e,n){for(var t=[],o=0;e.length>o;o++)n(e[o],o,e)&&t.push(e[o]);return t}function s(e,n){for(var t=0,o=e.length;o>=0;o--){var r=e[o];"."==r?e.splice(o,1):".."===r?(e.splice(o,1),t++):t&&(e.splice(o,1),t--)}if(n)for(;t--;t)e.unshift("..");return e}var p=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;t.resolve=function(){for(var e="",n=!1,t=arguments.length;t>=-1&&!n;t--){var o=t>=0?arguments[t]:a.cwd();"string"==typeof o&&o&&(e=o+"/"+e,n="/"===o.charAt(0))}return e=s(i(e.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+e||"."},t.normalize=function(e){var n="/"===e.charAt(0),t="/"===e.slice(-1);return e=s(i(e.split("/"),function(e){return!!e}),!n).join("/"),e||n||(e="."),e&&t&&(e+="/"),(n?"/":"")+e},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(i(e,function(e){return e&&"string"==typeof e}).join("/"))},t.dirname=function(e){var n=p.exec(e)[1]||"",t=!1;return n?1===n.length||t&&3>=n.length&&":"===n.charAt(1)?n:n.substring(0,n.length-1):"."},t.basename=function(e,n){var t=p.exec(e)[2]||"";return n&&t.substr(-1*n.length)===n&&(t=t.substr(0,t.length-n.length)),t},t.extname=function(e){return p.exec(e)[3]||""}}),require.define("__browserify_process",function(e,n,t,o,r,a){var a=n.exports={};a.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(n){var t=[];return window.addEventListener("message",function(e){if(e.source===window&&"browserify-tick"===e.data&&(e.stopPropagation(),t.length>0)){var n=t.shift();n()}},!0),function(e){t.push(e),window.postMessage("browserify-tick","*")}}return function(e){setTimeout(e,0)}}(),a.title="browser",a.browser=!0,a.env={},a.argv=[],a.binding=function(n){if("evals"===n)return e("vm");throw Error("No such module. (Possibly not yet loaded)")},function(){var n,t="/";a.cwd=function(){return t},a.chdir=function(o){n||(n=e("path")),t=n.resolve(o,t)}}()}),require.define("/log.js",function(e,n,t){var o=function(){var e=0,n=[],t={ERROR:0,WARNING:1,INFO:2,DEBUG:3},o=function(){return n},r=function(o){e=o===void 0?t.ERROR:o;var r=function(e,o){var r=function(e,n){var t=a[e].apply(null,Array.prototype.slice.call(n));return s(JSON.stringify(t)),t};return o===t.DEBUG?function(){var t=r(e,arguments);return n.push(t),t}:o===t.INFO?function(){var n=r(e,arguments);return n}:function(){}};for(var i in a)a.hasOwnProperty(i)&&(this[i]=r(i,e))},a={setCenter:function(e){return{category:"change-center",action:"set",center:e}},setZoom:function(e){return{category:"change-zoom",action:"set",zoom:e}},setState:function(e,n){return{category:"change-state",action:"set",center:e,zoom:n}},receivedCenter:function(e){return{category:"change-center",action:"receive",center:e}},receivedZoom:function(e){return{category:"change-zoom",action:"receive",zoom:e}},receivedState:function(e,n){return{category:"change-state",action:"receive",center:e,zoom:n}},sentCenter:function(e){return{category:"change-center",action:"send",center:e}},sentZoom:function(e){return{category:"change-zoom",action:"send",zoom:e}},sentState:function(e,n){return{category:"change-state",action:"send",center:e,zoom:n}}},i=function(e){return"["+new Date+"] "+e},s=function(n){e>=t.INFO&&console.log(i(n))},p=function(n){e>=t.WARNING&&console.warn(i(n))},c=function(n){e>=t.ERROR&&console.error(i(n))},l=function(n){e>=t.DEBUG&&console.log(i(n))};return{levels:t,info:s,warn:p,err:c,debug:l,setLogLevel:r,getLogs:o}}();t.log=o});var Hosts={};Hosts.addressFind="http://www.mapwith.me/map_find",Hosts.venuesFind="http://www.mapwith.me/venue_find",Hosts.collaboration="http://www.mapwith.me:8000",Hosts.baseURL="http://www.mapwith.me",Hosts.tiles="http://www.mapwith.me:8888/v2/maps/{z}/{x}/{y}.png";var SanFrancisco={center:{latitude:37.7785,longitude:-122.4192},upperLeft:{latitude:38.4948,longitude:-123.2128},lowerRight:{latitude:37.1716,longitude:-121.5401}},Boston={center:{latitude:42.3605,longitude:-71.0593},upperLeft:{latitude:42.702,longitude:-71.861},lowerRight:{latitude:41.951,longitude:-70.285}},Cities={"san-francisco":SanFrancisco,boston:Boston},DefaultCity="san-francisco",MapApp={useLeaflet:!1,log:require("/log.js").log};MapApp.log.setLogLevel(MapApp.log.levels.ERROR),MapApp.content=function(){var e='<div class="row-fluid"><div class="span12"><div class="span6"><p>Type your name and then click <strong>Start</strong>. This will create a link that you can share with your friends.</p></div><div class="span6"><form id="popover-form"><div class="input-append"><input id="popover-form-input" class="input-medium" type="text" placeholder="Type your name"><button id="popover-form-button" class="btn" type="submit">Start</button></div></form></div></div></div>',n="Share what you are viewing!",t='<div id="session-link"><code>LINK</code></div>',o="You are now sharing this map!",r='<div class="modal fade hide" id="initial-modal" style="width:350px"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">x</button><h3> Your friend wants to map with you</h3></div><div class="modal-body" ><div><p>Type your name and then click <strong>Join</strong> to start sharing.</p> </div><form id="modal-form"><center><input id="modal-form-input" class="input-large" type="text" placeholder="Type your name"></center></form></div><div class="modal-footer"><a href="#" class="btn" data-dismiss="modal">Close</a><a href="#" class="btn btn-primary" id="join-modal">Join</a></div></div>';return{startSession:e,startSessionTitle:n,sessionLink:t,sessionLinkTitle:o,joinSession:r}}(),MapApp.assert=function(e,n){if(!e)throw MapApp.log.err(n),new AssertException(n)};var urlParam=function(e){MapApp.log.info("Retrieving URL parameter "+e);var n=RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return n?n[1]:null},isSameCenter=function(e,n){return 1e-4>Math.abs(e.latitude-n.latitude)&&1e-4>Math.abs(n.longitude-n.longitude)};MapApp.collab=function(){function e(e,n){var t=s("change_state");l("change_state",t,{center:e,zoom:n}),MapApp.log.sentState(e,n)}function n(e){MapApp.log.info("[message] Emitting message: "+e),t.emit("send_message",{message:e})}var t,o,r=0,a=[],i=[],s=function(e,n){var t=!1;if(c(e,i,function(o,r){var a=r.data;switch(e){case"change_zoom":a.zoom===n.zoom&&(i.splice(o,1),t=!0);break;case"change_center":isSameCenter(a.center,n.center)&&(i.splice(o,1),t=!0)}}),t)return-1;var o=++r,s=c(e,a,function(e,n){n.xid=o});return s||a.push({opType:e,xid:o}),o},p=function(e,n){var t;return(t=c(n,a,function(n,t){t.xid===e.xid&&a.splice(n,1)}))?!1:(t=c(n,i,function(n,t){t.data=e}),t||i.push({opType:n,data:e}),!0)},c=function(e,n,t){for(var o=!1,r=n.length-1;r>=0;r-=1){var a=n[r];a.hasOwnProperty("opType")&&a.opType===e&&(t(r,a),o=!0)}return o},l=function(e,n,o){o.xid=n,t.emit(e,o)},u=function(){MapApp.assert(t,"Socket must be initialized");var e=function(e,n){t.on(e,function(t){p(t,e)?n(t):MapApp.log.info("["+e+"] Filtered message due to "+"pending state. Message was: "+JSON.stringify(t))})};t.on("search",function(e){MapApp.log.info("[search] Received "+JSON.stringify(e)),MapApp.collab.trigger("search",e)}),e("change_center",function(e){MapApp.log.receivedCenter(e.center),MapApp.collab.trigger("change_center",e)}),e("change_zoom",function(e){MapApp.log.receivedZoom(e.zoom),MapApp.collab.trigger("change_zoom",e)}),e("change_state",function(e){MapApp.log.receivedState(e.center,e.zoom),MapApp.collab.trigger("change_state",e)}),e("send_message",function(e){MapApp.log.info("[send_message] Received "+JSON.stringify(e)),MapApp.collab.trigger("send_message",e)}),e("add_user",function(e){MapApp.log.info("[add_user] Received "+JSON.stringify(e)),MapApp.collab.trigger("add_user",e)}),e("init_ack",function(e){MapApp.log.info("[init_ack] Received initialize ack for collab session: "+JSON.stringify(e)),o=e.cid,MapApp.collab.trigger("init_ack",e),MapApp.collab.trigger("change_state",{center:{latitude:e.state.center.latitude,longitude:e.state.center.longitude},zoom:e.state.zoom})}),e("error",function(e){MapApp.log.err(JSON.stringify(e))})},d=function(e){MapApp.log.info("[search] Emitting address: "+e);var n=s("search");l("search",n,{address:e})},f=function(e){MapApp.log.info("[init] Emitting init: "+JSON.stringify(e));var n=s("init");l("init",n,e)},g=function(){MapApp.log.info("[start-session] User is starting share session");var e={center:MapApp.map.getCenter(),zoom:MapApp.map.getZoom(),username:$("#popover-form-input").val()};return f(e),!1},m=function(){MapApp.log.info("[join-session] User is joining share session");var e={session_id:urlParam("session_id"),username:$("#modal-form-input").val()};return f(e),!1},v=function(e){var n={center:e},t=s("change_center",n);t>0&&(l("change_center",t,n),MapApp.log.sentCenter(e))},h=function(e){var n={zoom:e},t=s("change_zoom",n);t>0&&(l("change_zoom",t,n),MapApp.log.sentZoom(e))};return t=io.connect(Hosts.collaboration),u(),{startSession:g,joinSession:m,sendSearch:d,sendChangeCenter:v,sendChangeZoom:h,sendChangeState:e,sendMessage:n}}(),_.extend(MapApp.collab,Backbone.Events),MapApp.chatWindow=function(){var e="icon-eye-open",n=function(e,n){$("#chat-panel-rows .message:last").after('<div class="message"><span class="sender">'+e+"</span>"+n+"</div>"),$("#chat-panel-rows").each(function(){var e=Math.max(this.scrollHeight,this.clientHeight);this.scrollTop=e-this.clientHeight})},t=function(n){var t="icon_"+n,r="user_list_elem_"+n;$("#user_list li:last").after("<li id='"+r+"'>"+"<i id='"+t+"' class='"+e+"'></i>"+n+"</li>"),o(n);var a=$("#user_list li").length-2,i=a>1?" friends":" friend";a>0?$("#user_list_title").text("Sharing with "+a+i+": "):$("#user_list_title").text("No friends have joined")},o=function(n){var t="icon_"+n;$("#"+t).attr("class",e)},r=function(e,o){var r=13,a=function(){var t=$.trim($("#chat_text").val());return""!==t&&(n("Me",t),e&&e(t)),$("#chat_text").val(""),!1};if($("#chat_button").click(a),$("#chat_text").keydown(function(e){return e.keyCode===r?(a(),!1):void 0}),t("Me"),o!==void 0)for(var i=0;o.length>i;i++)t(o[i]);$("#right-bar").css("display",""),MapApp.collab.on("send_message",function(e){n(e.from,e.message)}),MapApp.collab.on("add_user",function(e){t(e.username)})};MapApp.collab.on("init_ack",function(e){r(function(e){MapApp.collab.sendMessage(e)},e.state.usernames)});var a=["#chat-header","#chat-window"];$(document).ready(function(){$(".right-bar-minimize").click(function(){for(var e=0;2>e;e++){var n=$(a[e]);n.animate({marginLeft:0===parseInt(n.css("marginLeft"),10)?n.outerWidth()-20:0})}})})}(),MapApp.map=function(){var e,n=Cities,t=DefaultCity,o={min:11,max:18,defaultZoom:13,foundZoom:15},r=new L.LayerGroup,a={initialize:function(){$("#map").addClass("map-leaflet");var a=n[t].center;e=new L.Map("map",{center:new L.LatLng(a.latitude,a.longitude),zoom:o.defaultZoom,inertia:!1});var i=new L.TileLayer(Hosts.tiles,{maxZoom:o.max,minZoom:o.min});e.addLayer(r),e.addLayer(i),e.attributionControl.setPrefix('Powered by <a href="http://leaflet.cloudmade.com">Leaflet</a>, <a href="http://foursquare.com">Foursquare</a>, and <a href="http://www.google.com">Google</a>'),e.attributionControl.addAttribution('Map Data &copy; <a href="http://www.openstreetmap.org">OpenStreetMap</a>'),e.on("zoomend",function(){MapApp.map.clearMarkers(),m(l),v(u)})},setCenter:function(n){e.panTo(new L.LatLng(n.latitude,n.longitude),!0)},setZoom:function(n){e.setZoom(n,!0)},setView:function(n,t,o){e.setView(new L.LatLng(n.latitude,n.longitude),t,!1,o)},getCenter:function(){var n=e.getCenter();return{latitude:n.lat,longitude:n.lng}},getZoom:function(){return e.getZoom()},getCorner:function(){var n=e.getBounds().getNorthWest();return{latitude:n.lat,longitude:n.lng}},inBounds:function(e){for(var t in n)if(n.hasOwnProperty(t)){var o=n[t];if(e.latitude>=o.lowerRight.latitude&&e.latitude<=o.upperLeft.latitude&&e.longitude>=o.upperLeft.longitude&&e.longitude<=o.lowerRight.longitude)return!0}return!1},addMarker:function(e,n,t){var o=new L.LatLng(e.latitude,e.longitude),a=n,i=new L.Marker(o,{icon:a});if(t!==void 0){var s=null;t.icon&&(s=t.icon.prefix+"32.png"),i.bindPopup(p(s,t.name,t.stars,t.address)).openPopup()}return r.addLayer(i),o},clearMarkers:function(){r.clearLayers()},geopointImage:L.icon({iconUrl:"images/markers/pink-pin.png",shadowUrl:null,iconSize:new L.Point(16,28),iconAnchor:new L.Point(8,28),popupAnchor:new L.Point(0,-28)}),venueImage:L.icon({iconUrl:"images/markers/blue-pin.png",shadowUrl:null,iconSize:new L.Point(16,28),iconAnchor:new L.Point(8,28),popupAnchor:new L.Point(0,-28)}),enableCollabListeners:function(){e.on("dragend",M),e.on("collabend",y)}},i={initialize:function(){$("#map").addClass("map-google");var r=n[t].center,a={center:new google.maps.LatLng(r.latitude,r.longitude),zoom:o.defaultZoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.SATELLITE]},rotateControl:!1,streetViewControl:!1,tilt:0};e=new google.maps.Map(document.getElementById("map"),a),google.maps.event.addListener(e,"zoom_changed",function(){MapApp.map.clearMarkers(),m(l),v(u)})},setCenter:function(n){var t=MapApp.map.getCenter();isSameCenter(t,n)||e.panTo(new google.maps.LatLng(n.latitude,n.longitude))},setZoom:function(n){var t=MapApp.map.getZoom();t!==n&&e.setZoom(n)},setView:function(e,n){MapApp.map.setCenter(e),MapApp.map.setZoom(n)},getCenter:function(){var n=e.getCenter();return{latitude:n.lat(),longitude:n.lng()}},getZoom:function(){return e.getZoom()},getCorner:function(){var n=e.getBounds().getNorthEast();return{latitude:n.lat(),longitude:n.lng()}},inBounds:function(){return!0},addMarker:function(n,t,o){var r=new google.maps.LatLng(n.latitude,n.longitude),a=new google.maps.Marker({position:r,icon:t,map:e});if(o!==void 0){var i=null;o.icon&&(i=o.icon.prefix+"32.png");var s=new google.maps.InfoWindow({content:p(i,o.name,o.stars,o.address)});google.maps.event.addListener(a,"click",function(){s.open(e,a)})}return c.push(a),r},clearMarkers:function(){if(c){for(var e in c)c[e].setMap(null);c.length=0}},geopointImage:new google.maps.MarkerImage("images/markers/pink-pin.png",new google.maps.Size(16,28),new google.maps.Point(0,0),new google.maps.Point(8,28)),venueImage:new google.maps.MarkerImage("images/markers/blue-pin.png",new google.maps.Size(16,28),new google.maps.Point(0,0),new google.maps.Point(8,28)),enableCollabListeners:function(){google.maps.event.addListener(e,"zoom_changed",A),google.maps.event.addListener(e,"center_changed",M)}},s=function(e){var t=n[e].center;MapApp.map.setView(t,o.defaultZoom)},p=function(e,n,t,o){var r=function(e){for(var n="",t=0;5>t;t++)n+=e>t?"<span class='red-star'></span>":"<span class='gray-star'></span>";return n},a='<div style="overflow:auto;width:100%" >';return a+='<div class="venue-icon"> ',e&&(a+='<img class="venue-icon" src="'+e+'" />'),a+="</div>",a+='<div class="venue-main"> ',a+='<div style="font-weight:bold">'+n+"</div>",a+='<div style="height:16px">'+r(t)+"</div>",a+="</div>",a+="</div>",o&&(a+='<div class="venue-address">'+o+"</div>"),a},c=[],l=[],u=[],d=function(){l=[],u=[],MapApp.map.clearMarkers()},f=function(e){l=l.concat(e),m(e)},g=function(e){u=u.concat(e),v(e)},m=function(e){if(0!==e.length){MapApp.log.info("Call to renderGeopoints. Received "+e.length+" points.");for(var n=0;e.length>n;n++)MapApp.map.addMarker(e[n],MapApp.map.geopointImage)}},v=function(e){if(0!==e.length){MapApp.log.info("Call to renderVenues. Received "+e.length+" points."),e=e.slice(0);var n=MapApp.map.getZoom(),t=MapApp.map.getCenter(),o=MapApp.map.getCorner(),r=w(t,o),a=.002*r;MapApp.log.info("zoom level: "+n+", thresh radius: "+a);for(var i=!0,s=0;i;){i=!1;for(var p=0;e.length>p;p++){var c,l=e[p],u=h(l,e),d=e[u];c=d.popularity<l.popularity?u:p,a>w(d,l)&&(e.splice(c,1),i=!0,s+=1)}}MapApp.log.info("Spliced "+s+" venues"),MapApp.log.info("Rendering "+e.length+" venues");for(var f=0;e.length>f;f++){var g=e[f];MapApp.map.inBounds(g)&&MapApp.map.addMarker(g,MapApp.map.venueImage,g)}}},h=function(e,n){for(var t=$.map(n,function(n){return n===e?Number.MAX_VALUE:w(n,e)}),o=Number.MAX_VALUE,r=0,a=0;n.length>a;a++)o>t[a]&&(r=a,o=t[a]);return r},w=function(e,n){return Math.pow(e.latitude-n.latitude,2)+Math.pow(e.longitude-n.longitude,2)},M=function(){var e=MapApp.map.getCenter();MapApp.collab.sendChangeCenter(e)},A=function(){var e=MapApp.map.getZoom();MapApp.collab.sendChangeZoom(e)},y=function(){var e=MapApp.map.getCenter(),n=MapApp.map.getZoom();MapApp.collab.sendChangeState(e,n)};MapApp.collab.on("change_center",function(e){MapApp.map.setCenter(e.center)}),MapApp.collab.on("change_zoom",function(e){MapApp.map.setZoom(e.zoom)}),MapApp.collab.on("change_state",function(e){MapApp.map.setView(e.center,e.zoom,!0)}),MapApp.collab.on("init_ack",function(){MapApp.map.enableCollabListeners()});var b={defaultArea:t,mapZooms:o,setViewOnArea:s,clear:d,drawGeopoints:f,drawVenues:g};for(var _ in a)MapApp.useLeaflet&&a.hasOwnProperty(_)?b[_]=a[_]:i.hasOwnProperty(_)&&(b[_]=i[_]);return b}(),MapApp.useLeaflet?window.addEventListener("load",MapApp.map.initialize):google.maps.event.addDomListener(window,"load",MapApp.map.initialize),MapApp.searchField=function(){var e="#address-input",n="images/loader.gif",t=function(){return $(e).val()},o=function(){$(e).css("background-image",'url("'+n+'")')},r=function(){$(e).css("background-image","")};return{showLoader:o,hideLoader:r,getInput:t}}(),MapApp.search=function(){var e=function(){var e=MapApp.searchField.getInput();return!e||/^\s*$/.test(e)?(MapApp.log.warn("Undefined or empty input"),!1):(MapApp.collab.sendSearch(e),!1)},n={cid:null,xid:null};return MapApp.collab.on("search",function(e){MapApp.log.info("[search] Current search is "+JSON.stringify(n));var t=e.from_cid===void 0,o=!n.cid&&!n.xid,r=e.from_cid===n.cid&&e.xid===n.xid;if(t||o||r){var a=e.type;switch(MapApp.log.info('[search] Performing search operation "'+e.type+'"'),a){case"begin":n.cid=e.from_cid,n.xid=e.xid,MapApp.searchField.showLoader(),MapApp.map.clear();break;case"end":MapApp.searchField.hideLoader(),n.cid=null,n.xid=null;break;case"draw_geopoints":e.points&&e.points.length>0&&(MapApp.map.drawGeopoints(e.points),MapApp.map.setView(e.points[0],MapApp.map.mapZooms.foundZoom));break;case"draw_venues":e.points&&e.points.length>0&&MapApp.map.drawVenues(e.points)}}}),{findAddress:e}}(),MapApp.shareButton=function(){var e="#share",n=function(){return $(e)},t=function(){n().removeClass("btn-inverse"),n().addClass("btn-success"),n().html("Sharing")};return MapApp.collab.on("init_ack",t),{getButton:n}}(),!function(e){"use strict";var n=function(e,n){this.init("sharepopover",e,n)};n.prototype=e.extend({},e.fn.popover.Constructor.prototype,{constructor:n,show:function(){var e,n,t,o,r,a,i;this.hasContent()&&this.enabled&&(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),a="bottom",n=/in/.test(a),e.remove().css({top:0,left:0,display:"block"}).appendTo(n?this.$element:document.body),t=this.getPosition(n),o=e[0].offsetWidth,r=e[0].offsetHeight,i={top:t.top+t.height+3,left:t.left+t.width-o},e.css(i).addClass(a).addClass("in"))}}),e.fn.sharepopover=function(t){return this.each(function(){var o=e(this),r=o.data("sharepopover"),a="object"==typeof t&&t;r||o.data("sharepopover",r=new n(this,a)),"string"==typeof t&&r[t]()})},e.fn.sharepopover.Constructor=n,e.fn.sharepopover.defaults=e.extend({},e.fn.popover.defaults,{template:'<div class="popover"><div class="arrow" style="left:93%"></div><div class="popover-inner" style="width:500px;"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),function(e){e.fn.vAlign=function(){return this.each(function(){var n=e(this).height(),t=e(this).parent().height(),o=Math.ceil((t-n)/2);e(this).css("margin-top",o)})}}(window.jQuery),MapApp.sessionInitWindow=function(){var e=MapApp.shareButton.getButton(),n=function(e){if(null===e)return MapApp.content.startSession;var n=MapApp.content.sessionLink.replace("LINK",e);return n},t=function(e){return null===e?MapApp.content.startSessionTitle:MapApp.content.sessionLinkTitle},o=function(){e.sharepopover("toggle"),$("#popover-form").length>0&&($("#popover-form").vAlign(),$("#popover-form").submit(MapApp.collab.startSession),$("#popover-form-button").click(MapApp.collab.startSession))},r=function(){e.sharepopover("hide")},a=function(o,r){var a=e.data("sharepopover");r&&(a.options.animation=!1),a.options.content=n(o),a.options.title=t(o),r&&(e.sharepopover("show"),a.options.animation=!0)};e.sharepopover({trigger:"manual",html:!0,content:n(null),title:t(null)}),window.onresize=r,e.click(o),MapApp.collab.on("init_ack",function(e){var n=Hosts.baseURL+"?session_id="+e.session_id;a(n,!0)})}(),MapApp.sessionJoinWindow=function(){var e=$(MapApp.content.joinSession),n=function(){$("body").append(e),$("#modal-form").submit(MapApp.collab.joinSession),$("#join-modal").click(MapApp.collab.joinSession),e.modal({backdrop:!0}).css({width:"auto","margin-left":function(){return-($(this).width()/2)}}),e.modal("show")};MapApp.collab.on("init_ack",function(){e.modal("hide")}),urlParam("session_id")&&n()}();