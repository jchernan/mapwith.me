var require=function(e,n){var t=require.resolve(e,n||"/"),o=require.modules[t];if(!o)throw Error("Failed to resolve module "+e+", tried "+t);var a=o._cached?o._cached:o();return a};require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(e,n){function t(e){if(require.modules[e])return e;for(var n=0;require.extensions.length>n;n++){var t=require.extensions[n];if(require.modules[e+t])return e+t}}function o(e){e=e.replace(/\/+$/,"");var n=e+"/package.json";if(require.modules[n]){var o=require.modules[n](),a=o.browserify;if("object"==typeof a&&a.main){var r=t(i.resolve(e,a.main));if(r)return r}else if("string"==typeof a){var r=t(i.resolve(e,a));if(r)return r}else if(o.main){var r=t(i.resolve(e,o.main));if(r)return r}}return t(e+"/index")}function a(e,n){for(var a=r(n),i=0;a.length>i;i++){var s=a[i],p=t(s+"/"+e);if(p)return p;var l=o(s+"/"+e);if(l)return l}var p=t(e);return p?p:void 0}function r(e){var n;n="/"===e?[""]:i.normalize(e).split("/");for(var t=[],o=n.length-1;o>=0;o--)if("node_modules"!==n[o]){var a=n.slice(0,o+1).join("/")+"/node_modules";t.push(a)}return t}if(n||(n="/"),require._core[e])return e;var i=require.modules.path();n=i.resolve("/",n);var s=n||"/";if(e.match(/^(?:\.\.?\/|\/)/)){var p=t(i.resolve(s,e))||o(i.resolve(s,e));if(p)return p}var l=a(e,s);if(l)return l;throw Error("Cannot find module '"+e+"'")}}(),require.alias=function(e,n){var t=require.modules.path(),o=null;try{o=require.resolve(e+"/package.json","/")}catch(a){o=require.resolve(e,"/")}for(var r=t.dirname(o),i=(Object.keys||function(e){var n=[];for(var t in e)n.push(t);return n})(require.modules),s=0;i.length>s;s++){var p=i[s];if(p.slice(0,r.length+1)===r+"/"){var l=p.slice(r.length);require.modules[n+l]=require.modules[r+l]}else p===r&&(require.modules[n]=require.modules[r])}},require.define=function(e,n){var t=require._core[e]?"":require.modules.path().dirname(e),o=function(e){return require(e,t)};o.resolve=function(e){return require.resolve(e,t)},o.modules=require.modules,o.define=require.define;var a={exports:{}};require.modules[e]=function(){return require.modules[e]._cached=a.exports,n.call(a.exports,o,a,a.exports,t,e),require.modules[e]._cached=a.exports,a.exports}},"undefined"==typeof process&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;return n&&window.addEventListener("message",function(n){if(n.source===window&&"browserify-tick"===n.data&&(n.stopPropagation(),e.length>0)){var t=e.shift();t()}},!0),function(t){n?(e.push(t),window.postMessage("browserify-tick","*")):setTimeout(t,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(e){if("evals"===e)return require("vm");throw Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),require.define("path",function(e,n,t){function o(e,n){for(var t=[],o=0;e.length>o;o++)n(e[o],o,e)&&t.push(e[o]);return t}function a(e,n){for(var t=0,o=e.length;o>=0;o--){var a=e[o];"."==a?e.splice(o,1):".."===a?(e.splice(o,1),t++):t&&(e.splice(o,1),t--)}if(n)for(;t--;t)e.unshift("..");return e}var r=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;t.resolve=function(){for(var e="",n=!1,t=arguments.length;t>=-1&&!n;t--){var r=t>=0?arguments[t]:process.cwd();"string"==typeof r&&r&&(e=r+"/"+e,n="/"===r.charAt(0))}return e=a(o(e.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+e||"."},t.normalize=function(e){var n="/"===e.charAt(0),t="/"===e.slice(-1);return e=a(o(e.split("/"),function(e){return!!e}),!n).join("/"),e||n||(e="."),e&&t&&(e+="/"),(n?"/":"")+e},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(o(e,function(e){return e&&"string"==typeof e}).join("/"))},t.dirname=function(e){var n=r.exec(e)[1]||"",t=!1;return n?1===n.length||t&&3>=n.length&&":"===n.charAt(1)?n:n.substring(0,n.length-1):"."},t.basename=function(e,n){var t=r.exec(e)[2]||"";return n&&t.substr(-1*n.length)===n&&(t=t.substr(0,t.length-n.length)),t},t.extname=function(e){return r.exec(e)[3]||""}}),require.define("/log.js",function(e,n,t){var o=function(){var e=0,n=[],t={ERROR:0,WARNING:1,INFO:2,DEBUG:3},o=function(){return n},a=function(o){e=o===void 0?t.ERROR:o;var a=function(e,o){var a=function(e,n){var t=r[e].apply(null,Array.prototype.slice.call(n));return s(JSON.stringify(t)),t};return o===t.DEBUG?function(){var t=a(e,arguments);return n.push(t),t}:o===t.INFO?function(){var n=a(e,arguments);return n}:function(){}};for(var i in r)r.hasOwnProperty(i)&&(this[i]=a(i,e))},r={setCenter:function(e){return{category:"change-center",action:"set",center:e}},setZoom:function(e){return{category:"change-zoom",action:"set",zoom:e}},setState:function(e,n){return{category:"change-state",action:"set",center:e,zoom:n}},receivedCenter:function(e){return{category:"change-center",action:"receive",center:e}},receivedZoom:function(e){return{category:"change-zoom",action:"receive",zoom:e}},receivedState:function(e,n){return{category:"change-state",action:"receive",center:e,zoom:n}},sentCenter:function(e){return{category:"change-center",action:"send",center:e}},sentZoom:function(e){return{category:"change-zoom",action:"send",zoom:e}},sentState:function(e,n){return{category:"change-state",action:"send",center:e,zoom:n}}},i=function(e){return"["+new Date+"] "+e},s=function(n){e>=t.INFO&&console.log(i(n))},p=function(n){e>=t.WARNING&&console.warn(i(n))},l=function(n){e>=t.ERROR&&console.error(i(n))},u=function(n){e>=t.DEBUG&&console.log(i(n))};return{levels:t,info:s,warn:p,err:l,debug:u,setLogLevel:a,getLogs:o}}();t.log=o}),require("/log.js"),require.define("/parallel_load.js",function(e,n,t){function o(e){this.callback=e,this.items=0,this.results={}}o.prototype={add:function(e,n){this.items++;var t=this;return function(o){t.results[e]=o,t.items--,n(e,o),0===t.items&&t.callback(t.results)}}},t.parallel_load=o}),require("/parallel_load.js"),require.define("/venue_merge.js",function(e,n,t){function o(e){console.log("merging console resuls");var n={geopoints:[],venues:[]},t={},o={};for(var a in e)if(e.hasOwnProperty(a)){var r,i=e[a];r=i.geopoints?i.geopoints:[i.geopoint];for(var s=0;r.length>s;s++){var p=r[s];t["lat"+p.latitude+"lon"+p.longitude]=p}for(var l in i.venues){var u=i.venues[l];o[u.id]=u}}for(var c in t)t.hasOwnProperty(c)&&n.geopoints.push(t[c]);for(var d in o)o.hasOwnProperty(d)&&n.venues.push(o[d]);return n}t!==void 0&&(t.venue_merge=o)}),require("/venue_merge.js");var Hosts={};Hosts.addressFind="http://www.mapwith.me/map_find",Hosts.venuesFind="http://www.mapwith.me/venue_find",Hosts.collaboration="http://www.mapwith.me:8000",Hosts.baseURL="http://www.mapwith.me",Hosts.tiles="http://www.mapwith.me:8888/v2/maps/{z}/{x}/{y}.png";var SanFrancisco={center:{latitude:37.7785,longitude:-122.4192},upperLeft:{latitude:38.4948,longitude:-123.2128},lowerRight:{latitude:37.1716,longitude:-121.5401}},Boston={center:{latitude:42.3605,longitude:-71.0593},upperLeft:{latitude:42.702,longitude:-71.861},lowerRight:{latitude:41.951,longitude:-70.285}},Cities={"san-francisco":SanFrancisco,boston:Boston},DefaultCity="san-francisco",MapApp={useLeaflet:!1,log:require("/log.js").log};MapApp.log.setLogLevel(MapApp.log.levels.ERROR),MapApp.content=function(){var e='<div class="row-fluid"><div class="span12"><div class="span6"><p>Type your name and then click <strong>Start</strong>. This will create a link that you can share with your friends.</p></div><div class="span6"><form id="popover-form"><div class="input-append"><input id="popover-form-input" class="input-medium" type="text" placeholder="Type your name"><button id="popover-form-button" class="btn" type="submit">Start</button></div></form></div></div></div>',n="Share what you are viewing!",t='<div id="session-link"><code>LINK</code></div>',o="You are now sharing this map!",a='<div class="modal fade hide" id="initial-modal" style="width:350px"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">x</button><h3> Your friend wants to map with you</h3></div><div class="modal-body" ><div><p>Type your name and then click <strong>Join</strong> to start sharing.</p> </div><form id="modal-form"><center><input id="modal-form-input" class="input-large" type="text" placeholder="Type your name"></center></form></div><div class="modal-footer"><a href="#" class="btn" data-dismiss="modal">Close</a><a href="#" class="btn btn-primary" id="join-modal">Join</a></div></div>';return{startSession:e,startSessionTitle:n,sessionLink:t,sessionLinkTitle:o,joinSession:a}}(),MapApp.assert=function(e,n){if(!e)throw MapApp.log.err(n),new AssertException(n)};var urlParam=function(e){MapApp.log.info("Retrieving URL parameter "+e);var n=RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return n?n[1]:null};MapApp.collab=function(){function e(e,n){var t=s("change_state");l("change_state",t,{center:e,zoom:n}),MapApp.log.sentState(e,n)}function n(e){MapApp.log.info("[message] Emitting message: "+e),t.emit("send_message",{message:e})}var t,o,a=0,r={opType:null,xid:null},i={opType:null,data:null},s=function(e,n){if(i.opType===e)switch(e){case"change_zoom":if(i.data.zoom===n.zoom)return i={opType:null,data:null},-1;break;case"change_center":if(1e-4>Math.abs(i.data.center.latitude-n.center.latitude)&&1e-4>Math.abs(i.data.center.longitude-n.center.longitude))return i={opType:null,data:null},-1}return r.opType=e,r.xid=++a,r.xid},p=function(e,n){return r.opType===n?(e.xid===r.xid&&(r={opType:null,xid:null}),!1):(i.opType=n,i.data=e,!0)},l=function(e,n,o){o.xid=n,t.emit(e,o)},u=function(){MapApp.assert(t,"Socket must be initialized");var e=function(e,n){t.on(e,function(t){p(t,e)?n(t):MapApp.log.info("["+e+"] Filtered message due to "+"pending state. Message was: "+JSON.stringify(t))})};t.on("search",function(e){MapApp.log.info("[search] Received "+JSON.stringify(e)),MapApp.collab.trigger("search",e)}),e("change_center",function(e){MapApp.log.receivedCenter(e.center),MapApp.collab.trigger("change_center",e)}),e("change_zoom",function(e){MapApp.log.receivedZoom(e.zoom),MapApp.collab.trigger("change_zoom",e)}),e("change_state",function(e){MapApp.log.receivedState(e.center,e.zoom),MapApp.collab.trigger("change_state",e)}),e("send_message",function(e){MapApp.log.info("[send_message] Received "+JSON.stringify(e)),MapApp.collab.trigger("send_message",e)}),e("add_user",function(e){MapApp.log.info("[add_user] Received "+JSON.stringify(e)),MapApp.collab.trigger("add_user",e)}),e("init_ack",function(e){MapApp.log.info("[init_ack] Received initialize ack for collab session: "+JSON.stringify(e)),o=e.cid,MapApp.collab.trigger("init_ack",e);var n=MapApp.map.getCenter(),t=MapApp.map.getZoom(),a=e.state.center,r=e.state.zoom;(t!==r||Math.abs(n.latitude-a.latitude)>1e-4||Math.abs(n.longitude-a.longitude)>1e-4)&&MapApp.collab.trigger("change_state",{center:{latitude:e.state.center.latitude,longitude:e.state.center.longitude},zoom:e.state.zoom})}),e("error",function(e){MapApp.log.err(JSON.stringify(e))})},c=function(e){MapApp.log.info("[search] Emitting address: "+e);var n=s("search");l("search",n,{address:e})},d=function(e){MapApp.log.info("[init] Emitting init: "+JSON.stringify(e));var n=s("init");l("init",n,e)},g=function(){MapApp.log.info("[start-session] User is starting share session");var e={center:MapApp.map.getCenter(),zoom:MapApp.map.getZoom(),username:$("#popover-form-input").val()};return d(e),!1},f=function(){MapApp.log.info("[join-session] User is joining share session");var e={session_id:urlParam("session_id"),username:$("#modal-form-input").val()};return d(e),!1},m=function(e){var n={center:e},t=s("change_center",n);t>0&&(l("change_center",t,n),MapApp.log.sentCenter(e))},v=function(e){var n={zoom:e},t=s("change_zoom",n);t>0&&(l("change_zoom",t,n),MapApp.log.sentZoom(e))};return t=io.connect(Hosts.collaboration),u(),{startSession:g,joinSession:f,sendSearch:c,sendChangeCenter:m,sendChangeZoom:v,sendChangeState:e,sendMessage:n}}(),_.extend(MapApp.collab,Backbone.Events),MapApp.chatWindow=function(){var e="icon-eye-open",n=function(e,n){$("#chat-panel-rows .message:last").after('<div class="message"><span class="sender">'+e+"</span>"+n+"</div>"),$("#chat-panel-rows").each(function(){var e=Math.max(this.scrollHeight,this.clientHeight);this.scrollTop=e-this.clientHeight})},t=function(n){var t="icon_"+n,a="user_list_elem_"+n;$("#user_list li:last").after("<li id='"+a+"'>"+"<i id='"+t+"' class='"+e+"'></i>"+n+"</li>"),o(n);var r=$("#user_list li").length-2,i=r>1?" friends":" friend";r>0?$("#user_list_title").text("Sharing with "+r+i+": "):$("#user_list_title").text("No friends have joined")},o=function(n){var t="icon_"+n;$("#"+t).attr("class",e)},a=function(e,o){var a=13,r=function(){var t=$.trim($("#chat_text").val());return""!==t&&(n("Me",t),e&&e(t)),$("#chat_text").val(""),!1};if($("#chat_button").click(r),$("#chat_text").keydown(function(e){return e.keyCode===a?(r(),!1):void 0}),t("Me"),o!==void 0)for(var i=0;o.length>i;i++)t(o[i]);$("#right_bar").css("display",""),MapApp.collab.on("send_message",function(e){n(e.from,e.message)}),MapApp.collab.on("add_user",function(e){t(e.username)})};MapApp.collab.on("init_ack",function(e){a(function(e){MapApp.collab.sendMessage(e)},e.state.usernames)})}(),MapApp.map=function(){var e,n=Cities,t=DefaultCity,o={min:11,max:18,defaultZoom:13,foundZoom:15},a=new L.LayerGroup,r={initialize:function(){$("#map").addClass("map-leaflet");var r=n[t].center;e=new L.Map("map",{center:new L.LatLng(r.latitude,r.longitude),zoom:o.defaultZoom,inertia:!1});var i=new L.TileLayer(Hosts.tiles,{maxZoom:o.max,minZoom:o.min});e.addLayer(a),e.addLayer(i),e.attributionControl.setPrefix('Powered by <a href="http://leaflet.cloudmade.com">Leaflet</a>, <a href="http://foursquare.com">Foursquare</a>, and <a href="http://www.google.com">Google</a>'),e.attributionControl.addAttribution('Map Data &copy; <a href="http://www.openstreetmap.org">OpenStreetMap</a>'),e.on("zoomend",function(){MapApp.map.clearMarkers(),m(u),v(c)})},setCenter:function(n){e.panTo(new L.LatLng(n.latitude,n.longitude),!0)},setZoom:function(n){e.setZoom(n,!0)},setView:function(n,t,o){e.setView(new L.LatLng(n.latitude,n.longitude),t,!1,o)},getCenter:function(){var n=e.getCenter();return{latitude:n.lat,longitude:n.lng}},getZoom:function(){return e.getZoom()},getCorner:function(){var n=e.getBounds().getNorthWest();return{latitude:n.lat,longitude:n.lng}},inBounds:function(e){for(var t in n)if(n.hasOwnProperty(t)){var o=n[t];if(e.latitude>=o.lowerRight.latitude&&e.latitude<=o.upperLeft.latitude&&e.longitude>=o.upperLeft.longitude&&e.longitude<=o.lowerRight.longitude)return!0}return!1},addMarker:function(e,n,t){var o=new L.LatLng(e.latitude,e.longitude),r=n,i=new L.Marker(o,{icon:r});if(t!==void 0){var s=null;t.icon&&(s=t.icon.prefix+"32.png"),i.bindPopup(p(s,t.name,t.stars,t.address)).openPopup()}return a.addLayer(i),o},clearMarkers:function(){a.clearLayers()},geopointImage:L.icon({iconUrl:"images/markers/pink-pin.png",shadowUrl:null,iconSize:new L.Point(16,28),iconAnchor:new L.Point(8,28),popupAnchor:new L.Point(0,-28)}),venueImage:L.icon({iconUrl:"images/markers/blue-pin.png",shadowUrl:null,iconSize:new L.Point(16,28),iconAnchor:new L.Point(8,28),popupAnchor:new L.Point(0,-28)}),enableCollabListeners:function(){e.on("dragend",M),e.on("collabend",y)}},i={initialize:function(){$("#map").addClass("map-google");var a=n[t].center,r={center:new google.maps.LatLng(a.latitude,a.longitude),zoom:o.defaultZoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.SATELLITE]},rotateControl:!1,streetViewControl:!1,tilt:0};e=new google.maps.Map(document.getElementById("map"),r),google.maps.event.addListener(e,"zoom_changed",function(){MapApp.map.clearMarkers(),m(u),v(c)})},setCenter:function(n){e.panTo(new google.maps.LatLng(n.latitude,n.longitude))},setZoom:function(n){e.setZoom(n)},setView:function(e,n){MapApp.map.setCenter(e),MapApp.map.setZoom(n)},getCenter:function(){var n=e.getCenter();return{latitude:n.lat(),longitude:n.lng()}},getZoom:function(){return e.getZoom()},getCorner:function(){var n=e.getBounds().getNorthEast();return{latitude:n.lat(),longitude:n.lng()}},inBounds:function(){return!0},addMarker:function(n,t,o){var a=new google.maps.LatLng(n.latitude,n.longitude),r=new google.maps.Marker({position:a,icon:t,map:e});if(o!==void 0){var i=null;o.icon&&(i=o.icon.prefix+"32.png");var s=new google.maps.InfoWindow({content:p(i,o.name,o.stars,o.address)});google.maps.event.addListener(r,"click",function(){s.open(e,r)})}return l.push(r),a},clearMarkers:function(){if(l){for(var e in l)l[e].setMap(null);l.length=0}},geopointImage:new google.maps.MarkerImage("images/markers/pink-pin.png",new google.maps.Size(16,28),new google.maps.Point(0,0),new google.maps.Point(8,28)),venueImage:new google.maps.MarkerImage("images/markers/blue-pin.png",new google.maps.Size(16,28),new google.maps.Point(0,0),new google.maps.Point(8,28)),enableCollabListeners:function(){google.maps.event.addListener(e,"zoom_changed",A),google.maps.event.addListener(e,"center_changed",M)}},s=function(e){var t=n[e].center;MapApp.map.setView(t,o.defaultZoom)},p=function(e,n,t,o){var a=function(e){for(var n="",t=0;5>t;t++)n+=e>t?"<span class='red-star'></span>":"<span class='gray-star'></span>";return n},r='<div style="overflow:auto;width:100%" >';return r+='<div class="venue-icon"> ',e&&(r+='<img class="venue-icon" src="'+e+'" />'),r+="</div>",r+='<div class="venue-main"> ',r+='<div style="font-weight:bold">'+n+"</div>",r+='<div style="height:16px">'+a(t)+"</div>",r+="</div>",r+="</div>",o&&(r+='<div class="venue-address">'+o+"</div>"),r},l=[],u=[],c=[],d=function(){u=[],c=[],MapApp.map.clearMarkers()},g=function(e){u=u.concat(e),m(e)},f=function(e){c=c.concat(e),v(e)},m=function(e){if(0!==e.length){MapApp.log.info("Call to renderGeopoints. Received "+e.length+" points.");for(var n=0;e.length>n;n++)MapApp.map.addMarker(e[n],MapApp.map.geopointImage)}},v=function(e){if(0!==e.length){MapApp.log.info("Call to renderVenues. Received "+e.length+" points."),e=e.slice(0);var n=MapApp.map.getZoom(),t=MapApp.map.getCenter(),o=MapApp.map.getCorner(),a=w(t,o),r=.002*a;MapApp.log.info("zoom level: "+n+", thresh radius: "+r);for(var i=!0,s=0;i;){i=!1;for(var p=0;e.length>p;p++){var l,u=e[p],c=h(u,e),d=e[c];l=d.popularity<u.popularity?c:p,r>w(d,u)&&(e.splice(l,1),i=!0,s+=1)}}MapApp.log.info("Spliced "+s+" venues"),MapApp.log.info("Rendering "+e.length+" venues");for(var g=0;e.length>g;g++){var f=e[g];MapApp.map.inBounds(f)&&MapApp.map.addMarker(f,MapApp.map.venueImage,f)}}},h=function(e,n){for(var t=$.map(n,function(n){return n===e?Number.MAX_VALUE:w(n,e)}),o=Number.MAX_VALUE,a=0,r=0;n.length>r;r++)o>t[r]&&(a=r,o=t[r]);return a},w=function(e,n){return Math.pow(e.latitude-n.latitude,2)+Math.pow(e.longitude-n.longitude,2)},M=function(){var e=MapApp.map.getCenter();MapApp.collab.sendChangeCenter(e)},A=function(){var e=MapApp.map.getZoom();MapApp.collab.sendChangeZoom(e)},y=function(){var e=MapApp.map.getCenter(),n=MapApp.map.getZoom();MapApp.collab.sendChangeState(e,n)};MapApp.collab.on("change_center",function(e){MapApp.map.setCenter(e.center)}),MapApp.collab.on("change_zoom",function(e){MapApp.map.setZoom(e.zoom)}),MapApp.collab.on("change_state",function(e){MapApp.map.setView(e.center,e.zoom,!0)}),MapApp.collab.on("init_ack",function(){MapApp.map.enableCollabListeners()});var b={defaultArea:t,mapZooms:o,setViewOnArea:s,clear:d,drawGeopoints:g,drawVenues:f};for(var _ in r)MapApp.useLeaflet&&r.hasOwnProperty(_)?b[_]=r[_]:i.hasOwnProperty(_)&&(b[_]=i[_]);return b}(),MapApp.useLeaflet?window.addEventListener("load",MapApp.map.initialize):google.maps.event.addDomListener(window,"load",MapApp.map.initialize),MapApp.searchField=function(){var e="#address-input",n="images/loader.gif",t=function(){return $(e).val()},o=function(){$(e).css("background-image",'url("'+n+'")')},a=function(){$(e).css("background-image","")};return{showLoader:o,hideLoader:a,getInput:t}}(),MapApp.search=function(){var e=function(){var e=MapApp.searchField.getInput();return!e||/^\s*$/.test(e)?(MapApp.log.warn("Undefined or empty input"),!1):(MapApp.collab.sendSearch(e),!1)},n={cid:null,xid:null};return MapApp.collab.on("search",function(e){MapApp.log.info("[search] Current search is "+JSON.stringify(n));var t=e.from_cid===void 0,o=!n.cid&&!n.xid,a=e.from_cid===n.cid&&e.xid===n.xid;if(t||o||a){var r=e.type;switch(MapApp.log.info('[search] Performing search operation "'+e.type+'"'),r){case"begin":n.cid=e.from_cid,n.xid=e.xid,MapApp.searchField.showLoader(),MapApp.map.clear();break;case"end":MapApp.searchField.hideLoader(),n.cid=null,n.xid=null;break;case"draw_geopoints":e.points&&e.points.length>0&&(MapApp.map.drawGeopoints(e.points),MapApp.map.setView(e.points[0],MapApp.map.mapZooms.foundZoom));break;case"draw_venues":e.points&&e.points.length>0&&MapApp.map.drawVenues(e.points)}}}),{findAddress:e}}(),MapApp.shareButton=function(){var e="#share",n=function(){return $(e)},t=function(){n().removeClass("btn-inverse"),n().addClass("btn-success"),n().html("Sharing")};return MapApp.collab.on("init_ack",t),{getButton:n}}(),!function(e){"use strict";var n=function(e,n){this.init("sharepopover",e,n)};n.prototype=e.extend({},e.fn.popover.Constructor.prototype,{constructor:n,show:function(){var e,n,t,o,a,r,i;this.hasContent()&&this.enabled&&(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),r="bottom",n=/in/.test(r),e.remove().css({top:0,left:0,display:"block"}).appendTo(n?this.$element:document.body),t=this.getPosition(n),o=e[0].offsetWidth,a=e[0].offsetHeight,i={top:t.top+t.height+3,left:t.left+t.width-o},e.css(i).addClass(r).addClass("in"))}}),e.fn.sharepopover=function(t){return this.each(function(){var o=e(this),a=o.data("sharepopover"),r="object"==typeof t&&t;a||o.data("sharepopover",a=new n(this,r)),"string"==typeof t&&a[t]()})},e.fn.sharepopover.Constructor=n,e.fn.sharepopover.defaults=e.extend({},e.fn.popover.defaults,{template:'<div class="popover"><div class="arrow" style="left:93%"></div><div class="popover-inner" style="width:500px;"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),function(e){e.fn.vAlign=function(){return this.each(function(){var n=e(this).height(),t=e(this).parent().height(),o=Math.ceil((t-n)/2);e(this).css("margin-top",o)})}}(window.jQuery),MapApp.sessionInitWindow=function(){var e=MapApp.shareButton.getButton(),n=function(e){if(null===e)return MapApp.content.startSession;var n=MapApp.content.sessionLink.replace("LINK",e);return n},t=function(e){return null===e?MapApp.content.startSessionTitle:MapApp.content.sessionLinkTitle},o=function(){e.sharepopover("toggle"),$("#popover-form").length>0&&($("#popover-form").vAlign(),$("#popover-form").submit(MapApp.collab.startSession),$("#popover-form-button").click(MapApp.collab.startSession))},a=function(){e.sharepopover("hide")},r=function(o,a){var r=e.data("sharepopover");a&&(r.options.animation=!1),r.options.content=n(o),r.options.title=t(o),a&&(e.sharepopover("show"),r.options.animation=!0)};e.sharepopover({trigger:"manual",html:!0,content:n(null),title:t(null)}),window.onresize=a,e.click(o),MapApp.collab.on("init_ack",function(e){var n=Hosts.baseURL+"?session_id="+e.session_id;r(n,!0)})}(),MapApp.sessionJoinWindow=function(){var e=$(MapApp.content.joinSession),n=function(){$("body").append(e),$("#modal-form").submit(MapApp.collab.joinSession),$("#join-modal").click(MapApp.collab.joinSession),e.modal({backdrop:!0}).css({width:"auto","margin-left":function(){return-($(this).width()/2)}}),e.modal("show")};MapApp.collab.on("init_ack",function(){e.modal("hide")}),urlParam("session_id")&&n()}();